<div
  class="modal fade"
  id="jobInfoModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="jobInfoModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content black-backend">
      <div class="modal-header">
        <h5 class="modal-title" id="jobInfoModalLabel">Job Information</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="jobInfoForm">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="jobTitle" class="form-label">İş Unvanı</label>
              <select class="form-control" id="jobTitle">
                <!-- Options populated from the backend -->
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label for="jobTask" class="form-label">Görev</label>
              <select class="form-control" id="jobTask">
                <!-- Options populated from the backend -->
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="department" class="form-label">Bölüm</label>
              <select class="form-control" id="department">
                <option value="" disabled selected hidden>Bölüm Seçin</option>
                <!-- Options populated from the backend -->
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label for="division" class="form-label">Birlik</label>
              <select class="form-control" id="division">
                <option value="" disabled selected hidden>Birim Seçin</option>
                <!-- Options populated from the backend -->
              </select>
            </div>
          </div>
          <div class="mb-3">
            <label for="jobDescription" class="form-label">İş Tanımı</label>
            <textarea class="form-control" id="jobDescription"></textarea>
          </div>
          <div class="mb-3">
            <label for="employeeType" class="form-label">Çalışan Türü</label>
            <select class="form-control" id="employeeType">
              <option value="" disabled selected hidden>
                Çalışan Türü Seçin
              </option>
              <!-- Options populated from the backend -->
            </select>
          </div>
          <div class="mb-3">
            <label for="groupName" class="form-label">Grup Adı</label>
            <select class="form-control" id="groupName">
              <option value="" disabled selected hidden>Gurup Seçin</option>
              <!-- Options populated from the backend -->
            </select>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="startDate" class="form-label">Başlangıç Tarihi</label>
              <input type="date" class="form-control" id="startDate" />
            </div>
            <div class="col-md-6 mb-3">
              <label for="terminationDate" class="form-label"
                >Bitiş Tarihi</label
              >
              <input type="date" class="form-control" id="terminationDate" />
            </div>
          </div>
          <button type="button" class="btn btn-primary" id="editJobBtn">
            Edit
          </button>
          <button
            type="submit"
            class="btn btn-success"
            id="saveJobBtn"
            style="display: none"
          >
            Save
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            id="cancelJobBtn"
            style="display: none"
          >
            Cancel
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  $("#editJobBtn").click(function () {
    $(
      "#jobTitle, #jobTask, #department, #division, #jobDescription, #employeeType, #groupName"
    ).removeAttr("disabled");
    $("#editJobBtn").hide();
    $("#saveJobBtn, #cancelJobBtn").show();
  });

  $("#cancelJobBtn").click(function () {
    $(
      "#jobTitle, #jobTask, #department, #division, #jobDescription, #employeeType, #groupName"
    ).attr("disabled", true);
    $("#saveJobBtn, #cancelJobBtn").hide();
    $("#editJobBtn").show();
  });

  $("#jobInfoForm").on("submit", function (event) {
    event.preventDefault();
    const userId = userid;
    const jobData = {
      title: $("#jobTitle").val(),
      task: $("#jobTask").val(),
      department: $("#department").val(),
      division: $("#division").val(),
      job_description: $("#jobDescription").val(),
      employee_type: $("#employeeType").val(),
      group_id: $("#groupName").val(),
      employment_start_date: $("#startDate").val(),
      termination_date: $("#terminationDate").val(),
    };
    console.log(jobData);

    $.ajax({
      url: `/admin/api/calisanlar/job/${userid}`,
      method: "PATCH",
      data: jobData,
      success: function (data) {
        showToast("Bilgiler", "Güncellendi");
        console.log("Job info updated successfully:", data);
        $("#job-info").DataTable().ajax.reload(null, false);
        $("#jobInfoModal").modal("hide");
      },
      error: function (jqXHR) {
        showToast("Bir hata oluştu: ", " " + jqXHR.responseText);
        console.error("Bilgiler güncellenirken bir hata oluştu.", jqXHR);
      },
    });
  });
</script>

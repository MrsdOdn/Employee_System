<%- include("../../../partials/image_upload_admin.ejs") %>
<div
  class="modal fade"
  id="profileModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="profileModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content black-backend">
      <div class="modal-header">
        <h5 class="modal-title" id="profileModalLabel">Employee Profile</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container">
          <div class="row">
            <div
              class="col-lg-4 col-md-12 d-flex justify-content-center align-items-center"
            >
              <div>
                <img
                  id="profile_image"
                  class="img-account-profile rounded-circle mb-2"
                  src="http://bootdey.com/img/Content/avatar/avatar1.png"
                  alt="profile image"
                />
                <div class="small font-italic text-muted mb-4">
                  JPG or PNG no larger than 1 MB
                </div>
                <button
                  type="button"
                  class="btn btn-primary"
                  data-toggle="modal"
                  data-target="#imageUploadModal"
                >
                  Yeni Resim Yükle
                </button>
              </div>
            </div>
            <div class="col-lg-8 col-md-12">
              <form id="employeeForm">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="first_name" class="form-label"
                      >First Name</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="first_name"
                      readonly
                    />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="last_name" class="form-label">Last Name</label>
                    <input
                      type="text"
                      class="form-control"
                      id="last_name"
                      readonly
                    />
                  </div>
                </div>
                <div class="mb-3">
                  <label for="email" class="form-label">Email</label>
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    readonly
                  />
                </div>
                <div class="mb-3">
                  <label for="phone_number" class="form-label"
                    >Phone Number</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="phone_number"
                    readonly
                  />
                </div>
                <div class="mb-3">
                  <label for="user_role" class="form-label"
                    >Kullanıcı Yetkisi</label
                  >
                  <select class="form-control" id="user_role" readonly>
                    <option value="" disabled selected hidden>
                      Yetki Seçin
                    </option>
                    <!-- Backend'den alınacak seçenekler burada dinamik olarak eklenecek -->
                  </select>
                </div>
                <button type="button" class="btn btn-primary" id="editBtn">
                  Edit
                </button>
                <button
                  type="submit"
                  class="btn btn-success"
                  id="saveBtn"
                  style="display: none"
                >
                  Save
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  id="cancelBtn"
                  style="display: none"
                >
                  Cancel
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  /* let img_eid = ""; */
  $(document).ready(function () {
    $("#editBtn").click(function () {
      $("input").removeAttr("readonly");
      $("#user_role").removeAttr("readonly");
      $("#editBtn").hide();
      $("#saveBtn, #cancelBtn").show();
    });

    $("#cancelBtn").click(function () {
      $("input").attr("readonly", true);
      $("#user_role").attr("readonly", true);
      $("#saveBtn, #cancelBtn").hide();
      $("#editBtn").show();
    });

    $("#employeeForm").submit(function (event) {
      event.preventDefault();

      const updatedData = {
        first_name: $("#first_name").val(),
        last_name: $("#last_name").val(),
        email: $("#email").val(),
        phone: $("#phone_number").val(),
        user_role: $("#user_role").val(),
      };
      console.log(updatedData);
      /* img_eid = userid; */
      $.ajax({
        url: "/admin/api/calisanlar/user/" + userid,
        method: "PATCH",
        data: JSON.stringify(updatedData),
        contentType: "application/json",
        success: function () {
          showToast("Bilgiler", "Güncellendi");
          $("#profileModal").modal("hide");
          $("#employees").DataTable().ajax.reload(null, false);
        },
        error: function (jqXHR) {
          showToast("Bir hata oluştu: ", " " + jqXHR.responseText);
          console.error("Bilgiler güncellenirken bir hata oluştu.", jqXHR);
        },
      });

      $("input").attr("readonly", true);
      $("#user_role").attr("readonly", true);
      $("#saveBtn, #cancelBtn").hide();
      $("#editBtn").show();
    });
  });
</script>
